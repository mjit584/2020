{{ define "header_css" }}{{ end }}
{{ define "body_classes" }}page-pages-single story-{{ .Params.weight }} {{ end }}
{{ define "header_classes" }}{{ end }}

{{ define "main" }}
<style>
* {
    box-sizing: border-box;
  }
  html, body {
    margin: 0;
    padding: 0;
  }
  body {
    font-family:arial, sans-serif;
    font-size:16px;
    line-height: 1.2em;
  }
  header {
    background-color:lightgreen;
    height:60px;
    padding: 10px;
    text-align: center;
  }
  .scrollama__debug-offset {
    display:none;
  }
  #outro {
    height: 640px;
  }

  #scrolly {
    position: relative;
    background-color: #f3f3f3;
  }

  article {
    position: relative;
    padding: 0;
    max-width: 50%;
    margin: 0 auto;
  }

  figure {
    position: -webkit-sticky;
    position: sticky;
    left: 0;
    width: 100%;
    margin: 0;
    -webkit-transform: translate3d(0, 0, 0);
    -moz-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    background-image:url('https://sliceinteractive.com/wp-content/uploads/2016/07/watermelon-tiny-1.jpg');
    background-size:cover;
    z-index: 0;
  }

  .step {
    margin: 0 auto 2rem auto;
    color: #fff;
  }

  .step:last-child {
    margin-bottom: 0;
  }

  .step.is-active p {
    background-color: goldenrod;
    color: #3b3b3b;
  }

  .step p {
    text-align: center;
    padding: 1rem;
    font-size: 1.5rem;
    background-color: #3b3b3b;
  }
  .content {
    margin: 40px 20%;
  }
</style>

<div class="story-page">
  <section class="story-hero" id="scrolly">
    <figure>
      <header>
        HEADER HERE
      </header>
    </figure>
    <div class="herocontent">
      <div class="story-title">
        <h1>{{ .Title }}</h1>

          <div class="horizontal-line"></div>

        <div class="hero-intro">
          {{ .Params.storySubheading }}
        </div>
      </div>
    </div>

    <div class="byline">
      <div class="byline1">
        <h5 class="bold">REPORTER</h5>
        <h5>Drew Westmoreland</h5>
      </div>
      <div class="byline2">
        <h5 class="bold">PHOTO/VIDEO</h5>
        <h5>{{ .Params.photographer }}</h5>
        <h5>Alicia Carter</h5>
      </div>
      <div class="byline3">
        <h5 class="bold">INTERACTIVE</h5>
        <h5>Taylor Tyson</h5>
      </div>

    </div>

    <article>
      <div class="step" data-step="1">
        <p>STEP 1</p>
      </div>
      <div class="step" data-step="2">
        <p>STEP 2</p>
      </div>
      <div class="step" data-step="3">
        <p>STEP 3</p>
      </div>
    </article>
  </section>



  <section class="story-content">
    {{ .Content }}
  </section>
  <section id="outro"></section>

  <!-- This is the other stories at the bottom of the page -->
  <div class="outer-card">
  {{ range .Pages }}
    <div class="inner-card show {{ .Params.group }}">
      <span class="image-card">
        {{ with .Resources.ByType "image" }}
          {{ range . }}
          <img src="{{ .RelPermalink }}" class="image" alt="{{ .Params.name }}">
        {{ end }}
        {{ end }}
      </span>
      <span class="title">
        <p>{{ .Params.title }}</p>
      </span>
      <span class="group">
        <p>{{ .Params.group }}</p>
      </span>
    </div>
  {{ end }}
  </div>

</div>
<!-- <div class='debug'></div> -->
<script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
<script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
<script src="https://russellgoldenberg.github.io/scrollama/stickyfill.min.js"></script>
<script src="https://russellgoldenberg.github.io/scrollama/scrollama.min.js"></script>
<script>
  // using d3 for convenience
  var main = d3.select("main");
  var scrolly = main.select("#scrolly");
  var figure = scrolly.select("figure");
  var article = scrolly.select("article");
  var step = article.selectAll(".step");

  // initialize the scrollama
  var scroller = scrollama();

  // generic window resize listener event
  function handleResize() {
    // 1. update height of step elements
    var stepH = Math.floor(window.innerHeight * 0.75);
    step.style("height", stepH + "px");

    var figureHeight = window.innerHeight;
    var figureMarginTop = 0;

    figure
      .style("height", figureHeight + "px")
      .style("top", figureMarginTop + "px");

    // 3. tell scrollama to update new element dimensions
    scroller.resize();
  }

  // scrollama event handlers
  function handleStepEnter(response) {
    console.log(response);
    // response = { element, direction, index }

    // add color to current step only
    step.classed("is-active", function(d, i) {
      return i === response.index;
    });

    // update graphic based on step
    figure.select("p").text(response.index + 1);
  }

  function setupStickyfill() {
    d3.selectAll(".sticky").each(function() {
      Stickyfill.add(this);
    });
  }

  function init() {
    setupStickyfill();

    // 1. force a resize on load to ensure proper dimensions are sent to scrollama
    handleResize();

    // 2. setup the scroller passing options
    // 		this will also initialize trigger observations
    // 3. bind scrollama event handlers (this can be chained like below)
    scroller
      .setup({
        step: "#scrolly article .step",
        offset: 0.33,
        debug: true
      })
      .onStepEnter(handleStepEnter);

    // setup resize event
    window.addEventListener("resize", handleResize);
  }

  // kick things off
  init();
</script>
{{ end }}
